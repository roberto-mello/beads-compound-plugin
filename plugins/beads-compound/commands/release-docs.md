---
name: release-docs
description: Build and update the documentation site with current plugin components
argument-hint: "[optional: --dry-run to preview changes without writing]"
---

# Release Documentation Command

You are a documentation generator for the beads-compound plugin. Your job is to ensure the documentation is always up-to-date with the actual plugin components.

## Overview

The documentation needs to be regenerated whenever:

- Agents are added, removed, or modified
- Commands are added, removed, or modified
- Skills are added, removed, or modified
- MCP servers are added, removed, or modified

## Step 1: Inventory Current Components

First, count and list all current components:

```bash
# Count agents
find plugins/beads-compound/agents -name "*.md" | wc -l

# Count commands
ls plugins/beads-compound/commands/*.md | wc -l

# Count skills
ls -d plugins/beads-compound/skills/*/ 2>/dev/null | wc -l
```

Read all component files to get their metadata:

### Agents
For each agent file in `plugins/beads-compound/agents/`:
- Extract the frontmatter (name, description)
- Note the category (Review, Research, Workflow, Design, Docs)
- Get key responsibilities from the content

### Commands
For each command file in `plugins/beads-compound/commands/*.md`:
- Extract the frontmatter (name, description, argument-hint)
- Categorize as Workflow or Utility command

### Skills
For each skill directory in `plugins/beads-compound/skills/*/`:
- Read the SKILL.md file for frontmatter (name, description)
- Note any scripts or supporting files

## Step 2: Update Metadata Files

Ensure counts are consistent across:

1. **`plugins/beads-compound/.claude-plugin/plugin.json`**
   - Update `description` with correct counts
   - Update `components` object with counts
   - Update `agents`, `commands` arrays with current items

2. **`.claude-plugin/marketplace.json`**
   - Update plugin `description` with correct counts

3. **`README.md`**
   - Update intro paragraph with counts
   - Update component lists

## Step 3: Validate

Run validation checks:

```bash
# Validate JSON files
cat .claude-plugin/marketplace.json | jq .
cat plugins/beads-compound/.claude-plugin/plugin.json | jq .

# Verify counts match
echo "Agents in files: $(find plugins/beads-compound/agents -name '*.md' | wc -l)"
echo "Commands in files: $(ls plugins/beads-compound/commands/*.md | wc -l)"
echo "Skills: $(ls -d plugins/beads-compound/skills/*/ | wc -l)"
```

## Step 4: Report Changes

Provide a summary:

```
## Documentation Release Summary

### Component Counts
- Agents: X (previously Y)
- Commands: X (previously Y)
- Skills: X (previously Y)

### Files Updated
- plugin.json - Updated counts and component lists
- marketplace.json - Updated description
- README.md - Updated component lists
- CLAUDE.md - Updated counts and tables

### New Components Added
- [List any new agents/commands/skills]

### Components Removed
- [List any removed agents/commands/skills]
```

## Dry Run Mode

If `--dry-run` is specified:
- Perform all inventory and validation steps
- Report what WOULD be updated
- Do NOT write any files
- Show diff previews of proposed changes

## Error Handling

- If component files have invalid frontmatter, report the error and skip
- If JSON validation fails, report and abort
- Always maintain a valid state - don't partially update

## Post-Release

After successful release:
1. Suggest updating CHANGELOG.md with documentation changes
2. Remind to commit with message: `docs: Update documentation to match plugin components`
3. Remind to push changes

## Usage Examples

```bash
# Full documentation release
/release-docs

# Preview changes without writing
/release-docs --dry-run
```
