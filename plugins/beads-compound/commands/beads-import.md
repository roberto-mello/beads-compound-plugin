---
name: beads-import
description: Import a markdown plan into beads as an epic with child tasks
argument-hint: "[path/to/plan.md] [optional epic title]"
---

# Import Markdown Plan Command

Import a markdown plan document into beads as an epic with child task beads.

## Introduction

This command takes a markdown plan file and creates a structured epic bead with child task beads for each implementation step. It automatically extracts research findings, decisions, and implementation steps from the markdown structure.

## Input

<input_document> #$ARGUMENTS </input_document>

## Execution Workflow

### Phase 1: Parse Arguments

1. **Extract Arguments**

   Parse the #$ARGUMENTS to get:
   - File path (required)
   - Epic title (optional)

   If no arguments provided:
   - Ask: "Please provide the path to the markdown plan file, e.g.: /beads-import plan.md"
   - Stop execution

   If only file path provided, the title will be auto-extracted from the first `#` header in the markdown file.

2. **Validate File Path**

   ```bash
   # Check if file exists and is readable
   if [[ ! -f "{file_path}" ]]; then
     echo "Error: File not found: {file_path}"
     exit 1
   fi
   ```

   If file doesn't exist:
   - Report: "File not found: {file_path}. Please provide a valid markdown file path."
   - Stop execution

3. **Extract Title from Markdown** (if not provided)

   Read the first line starting with `#` to extract the title:

   ```bash
   # Extract title from first # header
   title=$(grep -E "^# " "{file_path}" | head -1 | sed 's/^# *//')

   if [[ -z "$title" ]]; then
     echo "Error: Could not find title in markdown file (no # header found)"
     exit 1
   fi
   ```

   If no `#` header found and no title argument provided:
   - Ask: "No title found in markdown file. Please provide a title: /beads-import {file_path} \"Your Epic Title\""
   - Stop execution

### Phase 2: Run Import Script

1. **Call Import Script**

   Execute the import script with the validated arguments:

   ```bash
   # Determine PLUGIN_DIR based on whether this is a global or project install
   if [[ -f ".claude/scripts/import-plan.sh" ]]; then
     SCRIPT_PATH=".claude/scripts/import-plan.sh"
   elif [[ -f ".opencode/scripts/import-plan.sh" ]]; then
     SCRIPT_PATH=".opencode/scripts/import-plan.sh"
   else
     echo "Error: import-plan.sh script not found"
     echo "Expected at .claude/scripts/import-plan.sh or .opencode/scripts/import-plan.sh"
     exit 1
   fi

   bash "$SCRIPT_PATH" "{file_path}" "{title}"
   ```

2. **Capture Script Output**

   The import-plan.sh script will output:
   - Progress messages as it creates beads
   - Epic ID when created
   - Child bead IDs as they're created
   - Summary with next steps

   Capture the epic ID from the output:

   ```bash
   # Extract epic ID from output
   epic_id=$(echo "$output" | grep -oE 'Created epic: [A-Z]+-[0-9]+' | grep -oE '[A-Z]+-[0-9]+' | head -1)
   ```

### Phase 3: Report Results

1. **Display Summary**

   Present the import results to the user:

   ```
   Successfully imported plan from {file_path}

   Epic created: {EPIC_ID}
   Title: {title}

   Child beads created: {count}

   View the epic:
     bd show {EPIC_ID}

   List all child beads:
     bd list --parent {EPIC_ID}
   ```

2. **Suggest Next Steps**

   Use **AskUserQuestion tool** to present these options:

   **Question:** "Plan imported as epic `{EPIC_ID}`. What would you like to do next?"

   **Options:**
   1. **Run `/beads-deepen {EPIC_ID}`** - Enhance each child bead with parallel research agents
   2. **Run `/beads-plan-review {EPIC_ID}`** - Get feedback from reviewers on the plan
   3. **Start `/beads-work {EPIC_ID}.1`** - Begin implementing the first child bead
   4. **View epic** - Show the full epic bead details

   Based on selection:
   - **`/beads-deepen`** -> Call the /beads-deepen command with the epic ID
   - **`/beads-plan-review`** -> Call the /beads-plan-review command with the epic ID
   - **`/beads-work`** -> Call the /beads-work command with the first child bead ID
   - **View epic** -> Run `bd show {EPIC_ID}` and display the output
   - **Other** -> Accept free text for other actions

## Expected Markdown Format

The import script expects markdown with this structure:

```markdown
# Epic Title
Description of the overall feature or project.

## Research / Background
Research findings and context...

## Decisions / Approach
Architectural decisions and chosen approach...

## Implementation Steps / Tasks
### Step 1: Database Schema
Details about database changes...

### Step 2: API Endpoints
Details about API implementation...

### Step 3: Frontend Components
Details about UI changes...
```

**Key sections:**
- `# Epic Title` - Becomes the epic bead title (if not provided as argument)
- `## Research / Background / Context` - Captured as INVESTIGATION comments
- `## Decisions / Choices / Approach` - Captured as DECISION comments
- `## Implementation Steps / Tasks / Work` - Each `### Step` becomes a child bead
  - Child beads are created sequentially with dependencies (Step 2 depends on Step 1, etc.)

## Error Handling

**Common errors and solutions:**

| Error | Cause | Solution |
|-------|-------|----------|
| File not found | Invalid file path | Check path and try again |
| No title in markdown | Missing `#` header | Provide title as argument |
| Script not found | Plugin not installed | Run plugin installation |
| No implementation steps | Missing `###` headers | Add implementation section with steps |

## Notes

- The import script automatically creates sequential dependencies (each step depends on the previous)
- Research and decision sections are captured as knowledge comments on the epic
- Child bead descriptions are extracted from the content between `###` headers
- The script expects the plan to have an "Implementation Steps" section with `###` subheadings

## Quality Requirements

**Successful import requires:**
- Valid markdown file with clear structure
- At least one `#` header for the title (or title provided as argument)
- An "Implementation Steps" section with at least one `###` step
- Each step should have descriptive content below the `###` header

**The command should:**
- Validate file path before calling the script
- Extract title from markdown if not provided
- Display clear progress and results
- Suggest actionable next steps
- Handle errors gracefully with helpful messages
