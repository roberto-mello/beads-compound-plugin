---
name: beads-recall
description: Search knowledge base mid-session and inject relevant context
argument-hint: "[keywords, bead ID, or --flag]"
disable-model-invocation: true
---

# Beads Recall

Search the knowledge base (`.beads/memory/knowledge.jsonl`) mid-session and inject relevant context without restarting Claude Code.

## Usage

```bash
/beads-recall "oauth authentication"        # Search by keywords
/beads-recall BD-001                        # Recall knowledge for specific bead
/beads-recall --recent 10                   # Show 10 most recent entries
/beads-recall --stats                       # Knowledge base statistics
/beads-recall --topic BD-005                # All knowledge for epic's children
/beads-recall "api" --type learned          # Filter by type
```

## Input Handling

<input_document> #$ARGUMENTS </input_document>

**Parse the arguments to determine mode:**

1. **Check for flags first:**
   - `--stats` → Statistics mode
   - `--recent N` → Recent entries mode
   - `--topic BEAD_ID` → Topic/epic mode

2. **Check if argument matches bead ID pattern:**
   - Pattern: lowercase alphanumeric segments separated by hyphens
   - Regex: `^[a-z0-9]+-[a-z0-9]+(-[a-z0-9]+)*$`
   - Examples: `bd-001`, `oauth-bug`, `beads-feature-123`

3. **Otherwise treat as keyword search**

## Workflow

### Mode 1: Statistics (--stats)

```bash
bash .beads/memory/recall.sh --stats
```

Display the output directly as a code block:

```
## Knowledge Base Statistics

{statistics output from recall.sh}
```

### Mode 2: Recent Entries (--recent N)

```bash
bash .beads/memory/recall.sh --recent {N}
```

Format output:

```
## Recent Knowledge ({N} entries)

{formatted entries from recall.sh}
```

### Mode 3: Topic/Epic (--topic BEAD_ID)

```bash
bash .beads/memory/recall.sh --topic {BEAD_ID}
```

Format output:

```
## Knowledge for Topic: {BEAD_ID}

{formatted entries from recall.sh}
```

If no results:
```
No knowledge found for topic {BEAD_ID}.

The topic may not have child beads with captured knowledge yet.
```

### Mode 4: Bead ID Recall

When argument matches bead ID pattern:

1. **Load the bead:**
   ```bash
   bd show "#$ARGUMENTS" --json
   ```

2. **If bead doesn't exist:**
   ```
   ## Bead Not Found

   Bead ID '#$ARGUMENTS' not found. Check the ID with:

   ```bash
   bd list --status=open
   ```

   Stop execution.

3. **If bead exists, extract context:**
   ```bash
   TITLE=$(bd show "#$ARGUMENTS" --json | jq -r '.[0].title')
   TYPE=$(bd show "#$ARGUMENTS" --json | jq -r '.[0].type')
   ```

4. **Search using bead title as keywords:**
   ```bash
   bash .beads/memory/recall.sh "$TITLE"
   ```

5. **Also search by bead ID directly:**
   ```bash
   grep "\"bead\":\"#$ARGUMENTS\"" .beads/memory/knowledge.jsonl | jq -r '"\(.type | ascii_upcase): \(.content)"'
   ```

6. **Format output:**

   ```
   ## Knowledge Recall: {BEAD_ID}

   **Bead:** {TITLE} ({TYPE})

   ### Direct Knowledge (logged to this bead):

   {entries where bead field matches}

   ### Related Knowledge (matching "{TITLE}"):

   {entries from keyword search}
   ```

   If no results:
   ```
   ## No Knowledge Found

   No knowledge entries found for bead {BEAD_ID} or matching keywords from its title.

   To capture knowledge for this bead:
   ```bash
   bd comments add {BEAD_ID} "LEARNED: ..."
   ```

   Use `/beads-compound` for deep problem documentation.
   ```

### Mode 5: Keyword Search

When argument is plain text (not a flag or bead ID):

1. **Search with recall.sh:**
   ```bash
   bash .beads/memory/recall.sh "#$ARGUMENTS"
   ```

2. **Check for --type filter:**
   - If `#$ARGUMENTS` contains `--type learned|decision|fact|pattern|investigation`
   - Pass to recall.sh: `bash .beads/memory/recall.sh "query" --type TYPE`

3. **Format output:**

   ```
   ## Knowledge Recall: "{query}"

   Found {count} entries:

   {formatted output from recall.sh}
   ```

   If no results:
   ```
   ## No Matches Found

   No knowledge entries match "{query}".

   Try:
   - Different keywords (e.g., "auth" instead of "authentication")
   - Broader search terms
   - `/beads-recall --recent 20` to see latest entries
   - `/beads-recall --stats` to see all topics and tags
   ```

### Mode 6: Empty Arguments

If `#$ARGUMENTS` is empty:

```
## Knowledge Recall

Usage:
```bash
/beads-recall "keywords"           # Search by keywords
/beads-recall BD-001               # Recall for specific bead
/beads-recall --recent 10          # Show recent entries
/beads-recall --stats              # Database statistics
/beads-recall --topic BD-005       # Epic's knowledge
```

Or try:
```bash
/beads-recall --recent 10          # See what's been captured lately
```
```

## Output Format Standards

**Entry format from recall.sh:**
```
[TYPE] content
  bead: BD-XXX | tag1, tag2, tag3
```

**Always wrap in code blocks for readability.**

**Count results when possible:**
- Parse output line count (entries have 2 lines each)
- Report: "Found {count} entries" or "No matches found"

## Error Handling

**If .beads/memory/ doesn't exist:**
```
## Memory Not Initialized

This project doesn't have knowledge capture set up yet.

Run the beads-compound installer to enable memory features:
```bash
bash /path/to/beads-compound-plugin/install.sh
```
```

**If knowledge.jsonl doesn't exist:**
```
## No Knowledge Captured Yet

Knowledge base is empty. Start capturing knowledge:
```bash
bd comments add <BEAD_ID> "LEARNED: ..."
bd comments add <BEAD_ID> "DECISION: ..."
```

The memory-capture hook will automatically extract and store these.
```

**If bd command fails:**
```
Beads CLI not found. Install from: https://github.com/steveyegge/beads
```

## Post-Recall Suggestions

After showing results, suggest next actions:

**If results found:**
```
### Next Steps

- Use this knowledge to inform your current work
- Add new learnings: `bd comments add <BEAD_ID> "LEARNED: ..."`
- Document complex solutions: `/beads-compound`
```

**If implementing related work:**
```
Create a bead to track this work:
```bash
bd create --title="..." --type=feature --priority=2
```
```

## Notes

- Recall uses FTS5 full-text search (if sqlite3 available) with BM25 ranking
- Falls back to grep search if sqlite3 not installed
- Search is case-insensitive and supports fuzzy matching
- Archive can be included with `--all` flag (not exposed in this command for simplicity)
- Knowledge is git-tracked, so pulling updates automatically rebuilds the search index
